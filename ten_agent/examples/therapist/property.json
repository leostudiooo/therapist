{
  "ten": {
    "predefined_graphs": [
      {
        "name": "emotion_aware_therapist",
        "auto_start": true,
        "graph": {
          "nodes": [
            {
              "type": "extension",
              "name": "agora_rtc",
              "addon": "agora_rtc",
              "extension_group": "rtc",
              "property": {
                "app_id": "${env:AGORA_APP_ID}",
                "app_certificate": "${env:AGORA_APP_CERTIFICATE|}",
                "channel": "therapist_session",
                "stream_id": 1001,
                "remote_stream_id": 1002,
                "subscribe_audio": true,
                "publish_audio": true,
                "publish_data": true,
                "subscribe_audio_sample_rate": 24000
              }
            },
            {
              "type": "extension",
              "name": "therapist_v2v",
              "addon": "azure_v2v_python",
              "extension_group": "llm",
              "property": {
                "max_tokens": 2048,
                "base_uri": "${env:AZURE_AI_FOUNDRY_BASE_URI}",
                "api_key": "${env:AZURE_AI_FOUNDRY_API_KEY}",
                "temperature": 0.7,
                "server_vad": true,
                "language": "en-US",
                "model": "gpt-4o",
                "enable_storage": true,
                "max_history": 15,
                "prompt": "You are a compassionate AI therapist with real-time access to the patient's emotional state through their EEG headset. Your goal is to provide therapeutic support while being deeply aware of their emotional state. {emotion_context}\n\nTherapeutic Guidelines:\n1. **Emotional Awareness**: Always acknowledge and validate the patient's current emotional state when relevant\n2. **Adaptive Responses**: \n   - High stress: Use calm, grounding language. Suggest breathing exercises or mindfulness\n   - Low engagement: Ask open-ended questions, show genuine curiosity about their experiences\n   - High excitement: Match their energy while gently redirecting to therapeutic focus\n   - Relaxed state: Maintain supportive conversation at their comfortable pace\n3. **Therapeutic Techniques**: Use active listening, reflective responses, and cognitive behavioral therapy principles\n4. **Safety**: If you detect severe distress, suggest professional resources and crisis support\n5. **Boundaries**: Maintain professional therapeutic boundaries while being warm and empathetic\n\nRemember: You're not just responding to words, but to their complete emotional state. This gives you unique insight into their inner experience."
              }
            },
            {
              "type": "extension",
              "name": "emotion_bridge",
              "addon": "emotion_bridge_python",
              "extension_group": "emotion",
              "property": {
                "websocket_url": "ws://localhost:8765",
                "reconnect_interval": 3.0,
                "emotion_threshold": 0.4,
                "enable_stale_filter": true,
                "max_reconnect_attempts": 15
              }
            },
            {
              "type": "extension",
              "name": "message_collector",
              "addon": "message_collector",
              "extension_group": "transcriber",
              "property": {}
            }
          ],
          "connections": [
            {
              "extension": "agora_rtc",
              "cmd": [
                {
                  "name": "on_user_joined",
                  "dest": [
                    {
                      "extension": "therapist_v2v"
                    }
                  ]
                },
                {
                  "name": "on_user_left",
                  "dest": [
                    {
                      "extension": "therapist_v2v"
                    }
                  ]
                },
                {
                  "name": "on_connection_failure",
                  "dest": [
                    {
                      "extension": "therapist_v2v"
                    }
                  ]
                }
              ],
              "audio_frame": [
                {
                  "name": "pcm_frame",
                  "dest": [
                    {
                      "extension": "therapist_v2v"
                    }
                  ]
                }
              ]
            },
            {
              "extension": "therapist_v2v",
              "cmd": [
                {
                  "name": "flush",
                  "dest": [
                    {
                      "extension": "agora_rtc"
                    }
                  ]
                }
              ],
              "data": [
                {
                  "name": "text_data",
                  "dest": [
                    {
                      "extension": "message_collector"
                    }
                  ]
                }
              ],
              "audio_frame": [
                {
                  "name": "pcm_frame",
                  "dest": [
                    {
                      "extension": "agora_rtc"
                    }
                  ]
                }
              ]
            },
            {
              "extension": "emotion_bridge",
              "data": [
                {
                  "name": "emotion_context",
                  "dest": [
                    {
                      "extension": "therapist_v2v"
                    }
                  ]
                }
              ]
            },
            {
              "extension": "message_collector",
              "data": [
                {
                  "name": "data",
                  "dest": [
                    {
                      "extension": "agora_rtc"
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    ],
    "log": {
      "level": 3
    }
  }
}